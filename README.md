# Data Preprocessing & Feature Engineering Pipeline

æœ¬é¡¹ç›®å®ç°äº†ä¸€å¥—å®Œæ•´çš„ä¸­è‹±æ–‡æ–‡æœ¬æ•°æ®é¢„å¤„ç†ã€ç‰¹å¾å·¥ç¨‹åŠå¯è§†åŒ–æµæ°´çº¿ã€‚ä¸»è¦ç”¨äºå°†åŸå§‹æ–°é—»/ç¤¾äº¤åª’ä½“æ•°æ®è½¬æ¢ä¸ºé€‚åˆä¸‹æ¸¸æ¨¡å‹ï¼ˆå¦‚ OLDA åŠ¨æ€ä¸»é¢˜æ¨¡å‹ï¼‰è¾“å…¥çš„æ ¼å¼ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§ (Features)

1.  **å¤šè¯­è¨€ç‹¬ç«‹ç®¡é“ (Separate Pipelines)**
    *   **è‹±æ–‡ (English)**: 
        *   **åˆ†è¯ä¸æ¸…æ´—**: ä½¿ç”¨ `NLTK` åˆ†è¯ã€‚
        *   **è¯å½¢è¿˜åŸ (Lemmatization)**: ä½¿ç”¨ `WordNetLemmatizer` å°†å•è¯è¿˜åŸä¸ºåŸºæœ¬å½¢å¼ (å¦‚ `people` -> `people`, `countries` -> `country`)ã€‚
        *   **çŸ­è¯­è¯†åˆ« (Bigrams)**: è‡ªåŠ¨è¯†åˆ«å¹¶åˆå¹¶å¸¸è§çŸ­è¯­ (å¦‚ `South Korea`, `Prime Minister`, `Social Media`)ã€‚
        *   **è‡ªå®šä¹‰åœç”¨è¯**: è¿‡æ»¤ `said`, `report`, `time` ç­‰å¸¸è§æ–°é—»å¹²æ‰°è¯ã€‚
    *   **ä¸­æ–‡ (Chinese)**: 
        *   **ç²¾ç¡®åˆ†è¯**: ä½¿ç”¨ `Jieba` è¿›è¡Œåˆ†è¯ï¼Œæ”¯æŒåŠ è½½ `dict/custom_dict.txt` è‡ªå®šä¹‰è¯å…¸ (å¦‚ `é«˜å¸‚æ—©è‹—`, `é»‘é¹°`)ã€‚
        *   **åœç”¨è¯è¿‡æ»¤**: æ”¯æŒå¤šå±‚çº§åœç”¨è¯è¡¨ (`stopwords/` ç›®å½•)ï¼Œç²¾å‡†è¿‡æ»¤ `å¾®åš`, `è§†é¢‘`, `æ—¥æ–¹` ç­‰ä¸šåŠ¡å™ªéŸ³ã€‚

2.  **é«˜çº§ç‰¹å¾é€‰æ‹© (Advanced Feature Selection)**
    *   **è¯è¢‹æ¨¡å‹ (Bag-of-Words)**: ç”Ÿæˆç¨€ç–å‘é‡æ ¼å¼ã€‚
    *   **CHI-TFIDF è”åˆç­›é€‰**: 
        *   **ä½é¢‘è¿‡æ»¤**: å‰”é™¤æ–‡æ¡£é¢‘ç‡å°äº 5 çš„é•¿å°¾è¯ (`min_freq=5`)ã€‚
        *   **å¡æ–¹æ£€éªŒ (Chi-square)**: ç­›é€‰æœ€å…·ç±»åˆ«åŒºåˆ†åº¦çš„ Top 1000 ç‰¹å¾ã€‚
        *   **æƒé‡è¿‡æ»¤**: è¿›ä¸€æ­¥å‰”é™¤ TF-IDF æƒé‡è¿‡ä½çš„æ— æ•ˆç‰¹å¾ (`min_tfidf=0.01`)ï¼Œç¡®ä¿çƒ­åŠ›å›¾çº¯å‡€æ— å™ªéŸ³ã€‚

3.  **æ—¶é—´åºåˆ—ä¿ç•™ (Time Series Retention)**
    *   æ‰€æœ‰è¾“å‡ºæ–‡ä»¶å‡ä¸¥æ ¼ä¿ç•™ `date` æ—¶é—´æˆ³å­—æ®µï¼Œæ¸…æ´—å¹¶ç»Ÿä¸€æ ¼å¼ä¸º `YYYY-MM-DD HH:MM:SS`ï¼Œä»¥æ»¡è¶³åŠ¨æ€æ¨¡å‹çš„æ—¶é—´åˆ‡ç‰‡éœ€æ±‚ã€‚

4.  **å¯è§†åŒ– (Visualization)**
    *   **è¯äº‘ (Word Cloud)**: ç›´è§‚å±•ç¤ºä¸­è‹±æ–‡é«˜é¢‘å®ä½“ (å·²ä¿®å¤ä¸­æ–‡ä¹±ç é—®é¢˜)ã€‚
    *   **çƒ­åŠ›å›¾ (Heatmap)**: æŒ‰ç±»åˆ« (Label) èšåˆå±•ç¤ºç‰¹å¾è¯çš„æƒé‡åˆ†å¸ƒï¼Œç›´è§‚å‘ˆç°ä¸åŒè¯é¢˜çš„æ ¸å¿ƒå…³é”®è¯ã€‚

## ğŸ“‚ ç›®å½•ç»“æ„ (Directory Structure)

```plaintext
dataHandler/
â”œâ”€â”€ data/                   # è¾“å…¥æ•°æ®æº (BBC, People, Weibo ç­‰)
â”œâ”€â”€ output/                 # [è‡ªåŠ¨ç”Ÿæˆ] æ‰€æœ‰å¤„ç†ç»“æœã€å­—å…¸åŠå›¾è¡¨
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ preprocessor.py     # æ•°æ®åŠ è½½ã€åˆ†è¯ã€è¯å½¢è¿˜åŸã€Bigramã€æ¸…æ´—
â”‚   â”œâ”€â”€ text_mining.py      # BoW, Dictionary, CHI-TFIDF è®¡ç®—
â”‚   â”œâ”€â”€ feature_selection.py# å¡æ–¹æ£€éªŒä¸ TF-IDF ç­›é€‰é€»è¾‘
â”‚   â”œâ”€â”€ utils.py            # å·¥å…·å‡½æ•° (åœç”¨è¯åŠ è½½ç­‰)
â”‚   â”œâ”€â”€ visualization.py    # è¯äº‘ä¸çƒ­åŠ›å›¾ç»˜å›¾é€»è¾‘
â”‚   â””â”€â”€ count_top_words.py  # è¯é¢‘ç»Ÿè®¡è„šæœ¬
â”œâ”€â”€ main.py                 # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ requirements.txt        # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ stopwords/              # è‡ªå®šä¹‰ä¸­æ–‡åœç”¨è¯æ–‡ä»¶ (time.txt, noise_chars.txt)
â””â”€â”€ dict/                   # è‡ªå®šä¹‰è¯å…¸ (custom_dict.txt)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹ (Quick Start)

### 1. ç¯å¢ƒå®‰è£…
å»ºè®®ä½¿ç”¨ Conda åˆ›å»ºç‹¬ç«‹ç¯å¢ƒï¼š

```bash
conda create -n dataHandler python=3.9
conda activate dataHandler
pip install -r requirements.txt
```

### 2. è¿è¡Œä¸»ç¨‹åº
è¯¥å‘½ä»¤å°†æ‰§è¡Œå®Œæ•´æµæ°´çº¿ï¼šæ¸…æ´— -> å‘é‡åŒ– -> ç‰¹å¾é€‰æ‹© -> å¯è§†åŒ–ã€‚

```bash
python main.py
```

### 3. æŸ¥çœ‹è¯é¢‘ç»Ÿè®¡
å¦‚æœéœ€è¦æŸ¥çœ‹å¤„ç†åçš„ Top 10 é«˜é¢‘è¯ï¼š

```bash
python src/count_top_words.py
```

## ğŸ“„ è¾“å‡ºæ–‡ä»¶è¯´æ˜ (Outputs)

ç¨‹åºè¿è¡Œç»“æŸåï¼Œ`output/` ç›®å½•ä¸‹å°†ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼ˆ`{lang}` ä¸º `en` æˆ– `cn`ï¼‰ï¼š

| æ–‡ä»¶å | æè¿° | å…³é”®å­—æ®µ |
| :--- | :--- | :--- |
| `{lang}_processed.csv` | æ¸…æ´—åçš„åˆ†è¯æ–‡æœ¬ | `date`, `label`, `text_processed` |
| `{lang}_dictionary.txt` | è¯æ±‡ç´¢å¼•è¡¨ | `word`, `id` |
| `{lang}_bow.csv` | è¯è¢‹å‘é‡ (ç¨€ç–æ ¼å¼) | `date`, `label`, `bow_vector` (idx:count) |
| `{lang}_tfidf_chi.csv` | CHI ç­›é€‰åçš„ TF-IDF çŸ©é˜µ | `date`, `label`, `feature columns...` |
| `{lang}_wordcloud.png` | é«˜é¢‘è¯äº‘å›¾ | - |
| `{lang}_heatmap.png` | ç±»åˆ«-ç‰¹å¾é‡è¦æ€§çƒ­åŠ›å›¾ | - |

## ğŸ›  æ³¨æ„äº‹é¡¹
- **ä¸­æ–‡å­—ä½“**: å¯è§†åŒ–æ¨¡å—é»˜è®¤æŸ¥æ‰¾ macOS ç³»ç»Ÿå­—ä½“ `STHeiti Light.ttc`ã€‚å¦‚åœ¨ Linux/Windows è¿è¡Œï¼Œè¯·åœ¨ `main.py` ä¸­ä¿®æ”¹ `cn_font_path`ã€‚
- **æ•°æ®æ ‡ç­¾**:
    - ä¸­æ–‡æ•°æ®é»˜è®¤ä½¿ç”¨**çˆ¶æ–‡ä»¶å¤¹åç§°**ä½œä¸º Labelã€‚
    - è‹±æ–‡ BBC æ•°æ®ç‰¹æ®Šå¤„ç†ï¼Œä½¿ç”¨**æ–‡ä»¶å**ä½œä¸º Labelã€‚

---
**Author**: Younny
**Date**: 2025-12
